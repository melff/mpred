<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Generic function to preduce predictive margins — predmarg • mpred</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Generic function to preduce predictive margins — predmarg"><meta property="og:description" content="Generic function to preduce predictive margins"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mpred</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Generic function to preduce predictive margins</h1>

    <div class="hidden name"><code>predmarg.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Generic function to preduce predictive margins</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">predmarg</span><span class="op">(</span></span>
<span>  <span class="va">obj</span>,</span>
<span>  <span class="va">settings</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">subset</span>,</span>
<span>  type <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  groups <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  setup <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cifunc <span class="op">=</span> <span class="fu"><a href="get_cifunc.html">get_cifunc</a></span><span class="op">(</span><span class="va">obj</span><span class="op">)</span>,</span>
<span>  level <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  n <span class="op">=</span> <span class="fl">21</span>,</span>
<span>  trim <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  mc.cores <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">.Platform</span><span class="op">$</span><span class="va">OS.type</span> <span class="op">==</span> <span class="st">"windows"</span><span class="op">)</span> <span class="fl">1L</span> <span class="kw">else</span> <span class="va">max.cores</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-obj">obj<a class="anchor" aria-label="anchor" href="#arg-obj"></a></dt>
<dd><p>a model object, e.g. returned by <code>lm</code>, <code>glm</code>, etc.</p></dd>


<dt id="arg-settings">settings<a class="anchor" aria-label="anchor" href="#arg-settings"></a></dt>
<dd><p>an optional data frame of settings for independent variables
or a formula with variables for which settings are to be generated.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>an optional data frame for which the predictive margins are
computed. If ommited, an attempt is made to obtain the data from the
model object.</p></dd>


<dt id="arg-subset">subset<a class="anchor" aria-label="anchor" href="#arg-subset"></a></dt>
<dd><p>an optional logical vector that defines a subset for which a
predictive margin is computed</p></dd>


<dt id="arg-type">type<a class="anchor" aria-label="anchor" href="#arg-type"></a></dt>
<dd><p>an optional character string that specifies the type of
predictions, e.g. probabilities or cumulative probabilites. For future
versions only.</p></dd>


<dt id="arg-groups">groups<a class="anchor" aria-label="anchor" href="#arg-groups"></a></dt>
<dd><p>a variable that defines groups for which predictive margines
are computed. This variable has to have the same number of observations
as the data to which the model was fitted.</p></dd>


<dt id="arg-setup">setup<a class="anchor" aria-label="anchor" href="#arg-setup"></a></dt>
<dd><p>an optional expression that is evaluated for each setting,
i.e. individually for each row of the settings data frame. Can be used to
modify independent variables.</p></dd>


<dt id="arg-cifunc">cifunc<a class="anchor" aria-label="anchor" href="#arg-cifunc"></a></dt>
<dd><p>a function to compute prediction intervals. By default it is
the chosen by the function of the same name.</p></dd>


<dt id="arg-level">level<a class="anchor" aria-label="anchor" href="#arg-level"></a></dt>
<dd><p>level of confidence intervals of predictions.</p></dd>


<dt id="arg-parallel">parallel<a class="anchor" aria-label="anchor" href="#arg-parallel"></a></dt>
<dd><p>logical value that determines whether predictions for
individual settings are computed in parallel. (Does not yet work on
windows.)</p></dd>


<dt id="arg-n">n<a class="anchor" aria-label="anchor" href="#arg-n"></a></dt>
<dd><p>an integer number, the number of values generated for
an independent variable if <code>settings</code> is a formula.
The values form an equally spaced grid that cover the range from
the variable in <code>data</code>.</p></dd>


<dt id="arg-trim">trim<a class="anchor" aria-label="anchor" href="#arg-trim"></a></dt>
<dd><p>a number between 0 and 1. The proportion of
extreme values of variable in <code>data</code> that should be
trimed from the range of a generated set of values of
an independent variable.</p></dd>


<dt id="arg-mc-cores">mc.cores<a class="anchor" aria-label="anchor" href="#arg-mc-cores"></a></dt>
<dd><p>number of CPU cores used for parallel processing.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>optional vectors of values of independent variabls. These
further arguments, if present, are used to create a data frame of
settings, using <code><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></code>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>a data frame with the following variables:</p>
<dl><dt>pred</dt>
<dd><p>the mean prediction for the setting of the independent
    variables</p></dd>

<dt>var.pred</dt>
<dd><p>the (estimated) variance of the mean prediction</p></dd>

<dt>se.pred</dt>
<dd><p>the standard error of prediction, i.e. the square root of
    the variance of the mean prediction</p></dd>

<dt>lower</dt>
<dd><p>lower prediction interval computed with <code>qfunc</code></p></dd>

<dt>upper</dt>
<dd><p>upper prediction interval computed with <code>qfunc</code></p></dd>

<dt>...</dt>
<dd><p>the independent variables for which values are set to create
    the predictions are also included in the resulting data frame.</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>The generic function <code>predmarg</code> computes predictive
    margins for various settings of the independent variables. It is also
    possible to provide settings for independent variables that are
    included in the model, but that are used in the <code>setup</code>
    expression to transform independent variables. See the examples below.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Simple linear regression</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">height</span>, <span class="fl">2</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">women</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pm</span> <span class="op">&lt;-</span><span class="fu">predmarg</span><span class="op">(</span><span class="va">fm</span>,</span></span>
<span class="r-in"><span>              height<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fl">58</span>,to<span class="op">=</span><span class="fl">72</span>,</span></span>
<span class="r-in"><span>                         length<span class="op">=</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">pm</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 'data.frame':	10 obs. of  6 variables:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ pred    : num  115 119 123 128 133 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ var.pred: num  0.0685 0.0298 0.0182 0.019 0.0218 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ se.pred : num  0.262 0.173 0.135 0.138 0.148 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ lower   : num  115 119 123 127 132 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ upper   : num  116 119 123 128 133 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ height  : num  58 59.6 61.1 62.7 64.2 ...</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pred</span><span class="op">~</span><span class="va">height</span>,data<span class="op">=</span><span class="va">pm</span>,</span></span>
<span class="r-in"><span>     type<span class="op">=</span><span class="st">"l"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">women</span>, <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">height</span>,<span class="va">weight</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pm</span>, <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">height</span>,<span class="va">lower</span>,lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pm</span>, <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">height</span>,<span class="va">upper</span>,lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="predmarg-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Logistic regression</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-forge.r-project.org/projects/car/" class="external-link">carData</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">Chile</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">within</a></span><span class="op">(</span><span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">vote2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">vote</span>,levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"N"</span>,<span class="st">"Y"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">vote2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">vote2</span><span class="op">==</span><span class="st">"Y"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">glm.Chile.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">vote2</span><span class="op">~</span><span class="va">sex</span><span class="op">+</span><span class="va">age</span><span class="op">+</span><span class="va">income</span><span class="op">+</span><span class="va">education</span>,</span></span>
<span class="r-in"><span>                   data<span class="op">=</span><span class="va">Chile</span>,</span></span>
<span class="r-in"><span>                   family<span class="op">=</span><span class="va">binomial</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">glm.Chile.1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> glm(formula = vote2 ~ sex + age + income + education, family = binomial, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     data = Chile)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               Estimate Std. Error z value Pr(&gt;|z|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)  1.053e-01  1.786e-01   0.589 0.555615    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sexM        -5.415e-01  1.009e-01  -5.365 8.10e-08 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age          1.203e-02  3.594e-03   3.347 0.000817 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> income       4.481e-06  1.342e-06   3.339 0.000840 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> educationPS -1.125e+00  1.656e-01  -6.791 1.12e-11 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> educationS  -6.369e-01  1.207e-01  -5.276 1.32e-07 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Dispersion parameter for binomial family taken to be 1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Null deviance: 2361.7  on 1703  degrees of freedom</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residual deviance: 2239.0  on 1698  degrees of freedom</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   (996 observations deleted due to missingness)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AIC: 2251</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of Fisher Scoring iterations: 4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">pm.Chile.1.income</span> <span class="op">&lt;-</span> <span class="fu">predmarg</span><span class="op">(</span><span class="va">glm.Chile.1</span>,</span></span>
<span class="r-in"><span>                              income<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fl">2500</span>,to<span class="op">=</span><span class="fl">200000</span>,length<span class="op">=</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pred</span><span class="op">~</span><span class="va">income</span>,data<span class="op">=</span><span class="va">pm.Chile.1.income</span>,</span></span>
<span class="r-in"><span>     type<span class="op">=</span><span class="st">"l"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="predmarg-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Baseline category logit</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://mclogit.elff.eu" class="external-link">mclogit</a></span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: Matrix</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">MASS</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">mb.Chile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mclogit/man/mblogit.html" class="external-link">mblogit</a></span><span class="op">(</span><span class="va">vote</span><span class="op">~</span><span class="va">statusquo</span>,</span></span>
<span class="r-in"><span>                    data<span class="op">=</span><span class="va">Chile</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Iteration 1 - deviance = 4528.43 - criterion = 0.22885</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Iteration 2 - deviance = 4394.717 - criterion = 0.03042507</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Iteration 3 - deviance = 4383.817 - criterion = 0.002486294</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Iteration 4 - deviance = 4383.674 - criterion = 3.271481e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Iteration 5 - deviance = 4383.674 - criterion = 7.802726e-09</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> converged</span>
<span class="r-in"><span><span class="va">pm.mb.Chile</span> <span class="op">&lt;-</span> <span class="fu">predmarg</span><span class="op">(</span><span class="va">mb.Chile</span>,</span></span>
<span class="r-in"><span>                        statusquo<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="op">-</span><span class="fl">2</span>,to<span class="op">=</span><span class="fl">2</span>,length<span class="op">=</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">pm.mb.Chile</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 'data.frame':	80 obs. of  8 variables:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ pred     : num  0.018123 0.950795 0.030231 0.000851 0.025456 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ var.pred : num  1.38e-05 4.92e-05 2.21e-05 4.66e-08 2.10e-05 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ se.pred  : num  0.003713 0.007016 0.004698 0.000216 0.004578 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ lower    : num  0.011579 0.93617 0.021711 0.000482 0.017267 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ upper    : num  0.02608 0.96362 0.04009 0.00132 0.03516 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ eqnum    : int  1 2 3 4 1 2 3 4 1 2 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ statusquo: num  -2 -2 -2 -2 -1.79 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ response : Factor w/ 4 levels "A","N","U","Y": 1 2 3 4 1 2 3 4 1 2 ...</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">pm.mb.Chile</span>,</span></span>
<span class="r-in"><span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">statusquo</span>,</span></span>
<span class="r-in"><span>           y<span class="op">=</span><span class="va">pred</span>,</span></span>
<span class="r-in"><span>           fill<span class="op">=</span><span class="va">response</span></span></span>
<span class="r-in"><span>           <span class="op">)</span></span></span>
<span class="r-in"><span>       <span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_area</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="predmarg-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">pm.mb.Chile</span>,</span></span>
<span class="r-in"><span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">statusquo</span>,</span></span>
<span class="r-in"><span>           y<span class="op">=</span><span class="va">pred</span>,</span></span>
<span class="r-in"><span>           ymin<span class="op">=</span><span class="va">lower</span>,</span></span>
<span class="r-in"><span>           ymax<span class="op">=</span><span class="va">upper</span></span></span>
<span class="r-in"><span>           <span class="op">)</span></span></span>
<span class="r-in"><span>       <span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>alpha<span class="op">=</span><span class="fl">.25</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="op">~</span><span class="va">response</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="predmarg-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">mb.hs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mclogit/man/mblogit.html" class="external-link">mblogit</a></span><span class="op">(</span><span class="va">Sat</span><span class="op">~</span><span class="va">Infl</span><span class="op">+</span><span class="va">Type</span><span class="op">+</span><span class="va">Cont</span>,weights<span class="op">=</span><span class="va">Freq</span>,</span></span>
<span class="r-in"><span>                 data<span class="op">=</span><span class="va">housing</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Iteration 1 - deviance = 3493.764 - criterion = 0.9614469</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Iteration 2 - deviance = 3470.111 - criterion = 0.00681597</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Iteration 3 - deviance = 3470.084 - criterion = 7.82437e-06</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Iteration 4 - deviance = 3470.084 - criterion = 7.469596e-11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> converged</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">pm.mb.hs</span> <span class="op">&lt;-</span> <span class="fu">predmarg</span><span class="op">(</span><span class="va">mb.hs</span>,</span></span>
<span class="r-in"><span>                     Infl<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">Infl</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                     Type<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">Type</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">dodge</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width<span class="op">=</span><span class="fl">.8</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">pm.mb.hs</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Type</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>         <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">response</span>,</span></span>
<span class="r-in"><span>             x<span class="op">=</span><span class="va">Infl</span>,</span></span>
<span class="r-in"><span>             y<span class="op">=</span><span class="va">pred</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>         stat<span class="op">=</span><span class="st">'identity'</span>,position<span class="op">=</span><span class="va">dodge</span>,width<span class="op">=</span><span class="fl">.8</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>         <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Infl</span>,</span></span>
<span class="r-in"><span>             ymin<span class="op">=</span><span class="va">lower</span>,</span></span>
<span class="r-in"><span>             ymax<span class="op">=</span><span class="va">upper</span>,group<span class="op">=</span><span class="va">response</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>         position<span class="op">=</span><span class="va">dodge</span>,width<span class="op">=</span><span class="fl">.4</span><span class="op">)</span><span class="op">)</span> </span></span>
<span class="r-plt img"><img src="predmarg-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The following requires the most current 'mclogit' version on GitHub</span></span></span>
<span class="r-in"><span><span class="co"># and fails with the CRAN version</span></span></span>
<span class="r-in"><span><span class="co"># # Baseline category logit with random effects</span></span></span>
<span class="r-in"><span><span class="co"># </span></span></span>
<span class="r-in"><span><span class="co"># # Some artificial data</span></span></span>
<span class="r-in"><span><span class="co"># exadata &lt;- local({</span></span></span>
<span class="r-in"><span><span class="co">#     B &lt;- cbind(c(-.5,.3),</span></span></span>
<span class="r-in"><span><span class="co">#                c(.5,-.5))</span></span></span>
<span class="r-in"><span><span class="co">#     set.seed(42)</span></span></span>
<span class="r-in"><span><span class="co">#     x &lt;- rnorm(n=60)</span></span></span>
<span class="r-in"><span><span class="co">#     X &lt;- cbind(1,x)</span></span></span>
<span class="r-in"><span><span class="co">#     Eta &lt;- X %*% B</span></span></span>
<span class="r-in"><span><span class="co">#     j &lt;- rep(1:10,6)</span></span></span>
<span class="r-in"><span><span class="co">#     jf &lt;- as.factor(j)</span></span></span>
<span class="r-in"><span><span class="co">#     u1 &lt;- rnorm(n=10,sd=.8)</span></span></span>
<span class="r-in"><span><span class="co">#     u2 &lt;- rnorm(n=10,sd=.8)</span></span></span>
<span class="r-in"><span><span class="co">#     Eta &lt;- Eta + cbind(u1[j],x*u2[j])</span></span></span>
<span class="r-in"><span><span class="co">#     expEta &lt;- cbind(1,exp(Eta))</span></span></span>
<span class="r-in"><span><span class="co">#     sum.expEta &lt;- rowSums(expEta)</span></span></span>
<span class="r-in"><span><span class="co">#     pi &lt;- expEta/sum.expEta</span></span></span>
<span class="r-in"><span><span class="co">#     Y &lt;- t(apply(pi,1,rmultinom,n=1,size=300))</span></span></span>
<span class="r-in"><span><span class="co">#     res &lt;-data.frame(Y,x,j,jf)</span></span></span>
<span class="r-in"><span><span class="co">#     names(res)[1:3] &lt;- paste0("y",1:3)</span></span></span>
<span class="r-in"><span><span class="co">#     res</span></span></span>
<span class="r-in"><span><span class="co"># })</span></span></span>
<span class="r-in"><span><span class="co"># </span></span></span>
<span class="r-in"><span><span class="co"># # Baseline logit model with random intercepts and random slopes</span></span></span>
<span class="r-in"><span><span class="co"># mbrsl &lt;- mblogit(cbind(y1,y2,y3)~x,data=exadata,</span></span></span>
<span class="r-in"><span><span class="co">#                  random = ~1+x|j)</span></span></span>
<span class="r-in"><span><span class="co"># summary(mbrsl)</span></span></span>
<span class="r-in"><span><span class="co"># </span></span></span>
<span class="r-in"><span><span class="co"># # Predictive margins for values of x</span></span></span>
<span class="r-in"><span><span class="co"># pm.mbrsl &lt;- predmarg(mbrsl,x=seq(from=min(x),to=max(x),length=24))</span></span></span>
<span class="r-in"><span><span class="co"># (ggplot(pm.mbrsl,</span></span></span>
<span class="r-in"><span><span class="co">#        aes(x=x,</span></span></span>
<span class="r-in"><span><span class="co">#            y=pred,</span></span></span>
<span class="r-in"><span><span class="co">#            fill=response</span></span></span>
<span class="r-in"><span><span class="co">#            )</span></span></span>
<span class="r-in"><span><span class="co">#        ) + geom_area())</span></span></span>
<span class="r-in"><span><span class="co"># </span></span></span>
<span class="r-in"><span><span class="co"># # Predictive margins for the random effects</span></span></span>
<span class="r-in"><span><span class="co"># pm.mbrsl.j &lt;- predmarg(mbrsl,j=1:10)</span></span></span>
<span class="r-in"><span><span class="co"># (ggplot(pm.mbrsl.j,</span></span></span>
<span class="r-in"><span><span class="co">#        aes(x=j,</span></span></span>
<span class="r-in"><span><span class="co">#            y=pred,</span></span></span>
<span class="r-in"><span><span class="co">#            fill=response</span></span></span>
<span class="r-in"><span><span class="co">#            )</span></span></span>
<span class="r-in"><span><span class="co">#        ) + geom_bar(position="fill",stat="identity"))</span></span></span>
<span class="r-in"><span><span class="co"># </span></span></span>
<span class="r-in"><span><span class="co"># pm.mbrsl.jx &lt;- predmarg(mbrsl,</span></span></span>
<span class="r-in"><span><span class="co">#                     j=1:10,</span></span></span>
<span class="r-in"><span><span class="co">#                     x=seq(from=min(x),to=max(x),</span></span></span>
<span class="r-in"><span><span class="co">#                           length=24))</span></span></span>
<span class="r-in"><span><span class="co"># </span></span></span>
<span class="r-in"><span><span class="co"># (ggplot(pm.mbrsl.jx,</span></span></span>
<span class="r-in"><span><span class="co">#        aes(x=x,</span></span></span>
<span class="r-in"><span><span class="co">#            y=pred,</span></span></span>
<span class="r-in"><span><span class="co">#            fill=response</span></span></span>
<span class="r-in"><span><span class="co">#            )</span></span></span>
<span class="r-in"><span><span class="co">#        ) + geom_area()</span></span></span>
<span class="r-in"><span><span class="co">#     + facet_wrap(~j))</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Martin Elff.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer></div>






  </body></html>

